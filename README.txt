fast_gpu_net contains two gpu implementations of neural networks for pixel
classification in the rhoana pipeline. Convolutional contains an
implementation of a deep convolutional neural network, while fully_connected
contains an implementation of a deep fully connected network.

Convolutional:
main.py contains the overall architecture of the network. Running this file
will run a test of the network using random images. We are planning to add
wrappers to this file so it can be imported and used to classify a stack of
images with a single call specifying the image names and the name of a .pkl
file containing a network generated by pylearn2, but this has not been
implemented yet.

The network calls three gpu kernels, im2col_batched, sgemm_batched, and
maxpool_batched for each layer. 

im2col_batched: im2col_batched is a modified version of the caffe
implementation of im2col from Berkeley Vision and Learning Center. Given a set
of images (already on the gpu) and a kernel size it performs im2col on the
gpu.

sgemm_batched:  sgemm_batched is a cublas call made using cuda scikits
wrapper. It performs C = A*B + C for arrays of matrices A, B and C.

maxpool_batched: maxpool_batched is a gpu kernel to compute the maximum value
in a 3D block for a set of images.

Each of the kernels has a corresponding python wrapper that sets up the cuda
block and grid dimensions and calls the actual kernel.

To reduce cost from memory transfer these wrappers operate on handles to gpu
arrays and the only host to device or device to host transfers occur at the
beginning and end of classifying an image.


ARRAY INDICES:
Special attention should be paid to the order of indices used in the images.
Because of inconsitencies between the row-ordered C/numpy memory layouts and
the column-order gpu layout as well as between image indices and coordinate
indices, the order of dimensions is not obvious and not trivially
generalizable.



Fully Connected:
main.py performs classification like in the convolutional network, but is
already wrapped to be used as a module. The main function is a test function
set up to run timing and check that the output matches with output performed
using pylearn2 on the smae image and using the same model. As a module the use
will primarily be to call classify which takes a list of image names, a model
file name and a list of output names and classifies the whole set of images
using the model. There is also a classify_image function which takes an image
array and a model and returns the classified array. 

Image Formats: 
The input images are cast to floats and normalized and the output images are 8
bit integer images.


The fully connected network calls four kernels, im2col, sgemm, rectify, and soft_max.

For this network im2col and sgemm are used unbatched.

Rectify simply computes elementwise max(0, x)

soft_max is applied only in the last layer to convert 2D output to probability
values for the classes.
